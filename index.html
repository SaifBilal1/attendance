<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù…</title>
</head>

<body style="font-family:Arial;text-align:center;padding:20px">

<h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø§Ù„Ø®Ø±ÙˆØ¬</h2>

<input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" style="width:90%;padding:12px"><br><br>

<select id="type" style="width:90%;padding:12px">
  <option value="Ø¯Ø®ÙˆÙ„">Ø¯Ø®ÙˆÙ„</option>
  <option value="Ø®Ø±ÙˆØ¬">Ø®Ø±ÙˆØ¬</option>
</select><br><br>

<button onclick="start()" style="padding:15px;width:90%">ØªØ³Ø¬ÙŠÙ„</button>

<p id="status"></p>
  
<script>
const OFFICE_LAT = 43.99670666959595;
const OFFICE_LNG = 36.235097068414;
const ALLOWED_RADIUS = 1000;

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwMen6kkdRssGezbkm9B3HeJyb_14PURb3QuXX3TLL4XVZWc1onx4o1HS9iqYINuztDoA/exec";

function distance(lat1, lon1, lat2, lon2) {
  const R = 6371000;
  const dLat = (lat2-lat1)*Math.PI/180;
  const dLon = (lon2-lon1)*Math.PI/180;
  const a =
    Math.sin(dLat/2)**2 +
    Math.cos(lat1*Math.PI/180) *
    Math.cos(lat2*Math.PI/180) *
    Math.sin(dLon/2)**2;
  return 2 * R * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

function start() {
  document.getElementById("status").innerText = "ðŸ“ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...";

  navigator.geolocation.getCurrentPosition(pos => {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;

    if (distance(lat, lng, OFFICE_LAT, OFFICE_LNG) > ALLOWED_RADIUS) {
      document.getElementById("status").innerText = "ðŸš¨ Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…ÙˆÙ‚Ø¹";
      return;
    }

    fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({
        name: document.getElementById("name").value,
        type: document.getElementById("type").value,
        lat: lat,
        lng: lng
      })
    }).then(() => {
      document.getElementById("status").innerText = "âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­";
    });

  }, () => {
    alert("ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
  }, { enableHighAccuracy: true });
}
</script>

</body>
</html>


