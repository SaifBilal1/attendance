<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ุชุณุฌูู ุงูุฏูุงู</title>
</head>

<body style="font-family:Arial;text-align:center;padding:20px">

<h2>ุชุณุฌูู ุงูุฏุฎูู / ุงูุฎุฑูุฌ</h2>

<input id="name" placeholder="ุงูุงุณู ุงููุงูู" style="width:90%;padding:12px"><br><br>

<select id="type" style="width:90%;padding:12px">
  <option value="ุฏุฎูู">ุฏุฎูู</option>
  <option value="ุฎุฑูุฌ">ุฎุฑูุฌ</option>
</select><br><br>

<button onclick="start()" style="padding:15px;width:90%">ุชุณุฌูู</button>

<p id="status"></p>

<script>
// ===== ุฅุนุฏุงุฏุงุช ูููุน ุงูุฏูุงู =====
const OFFICE_LAT = 36.234905532743525;
const OFFICE_LNG = 43.99674391239932;
const ALLOWED_RADIUS = 300; // ูุชุฑ (ูุงุณุน ููุงุฎุชุจุงุฑ)

// ===== ุฑุงุจุท Google Apps Script (ูุซุจูุช) =====
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwMen6kkdRssGezbkm9B3HeJyb_14PURb3QuXX3TLL4XVZWc1onx4o1HS9iqYINuztDoA/exec";

// ===== ุฏุงูุฉ ุญุณุงุจ ุงููุณุงูุฉ =====
function distance(lat1, lon1, lat2, lon2) {
  const R = 6371000;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a =
    Math.sin(dLat / 2) ** 2 +
    Math.cos(lat1 * Math.PI / 180) *
    Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLon / 2) ** 2;
  return 2 * R * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

// ===== ุจุฏุก ุนูููุฉ ุงูุชุณุฌูู =====
function start() {
  document.getElementById("status").innerText = "๐ ุฌุงุฑู ุชุญุฏูุฏ ุงููููุน...";

  navigator.geolocation.getCurrentPosition(
    pos => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      const acc = pos.coords.accuracy; // ุฏูุฉ GPS ุจุงููุชุฑ

      console.log("LAT:", lat, "LNG:", lng, "ACC:", acc);

      // ุฅุฐุง ุฏูุฉ ุงููููุน ุถุนููุฉ
      if (acc > 200) {
        document.getElementById("status").innerText =
          "๐ก ุฅุดุงุฑุฉ GPS ุถุนููุฉุ ุงูุชุธุฑ ููููุงู ูุญุงูู ูุฑุฉ ุซุงููุฉ";
        return;
      }

      // ุญุณุงุจ ุงููุณุงูุฉ ูู ูููุน ุงูุฏูุงู
      const d = distance(lat, lng, OFFICE_LAT, OFFICE_LNG);

      if (d > ALLOWED_RADIUS) {
        document.getElementById("status").innerText = "๐จ ุฎุงุฑุฌ ูุทุงู ุงููููุน";
        return;
      }

      // ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู Google Sheets
      fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({
          name: document.getElementById("name").value,
          type: document.getElementById("type").value,
          lat: lat,
          lng: lng,
          accuracy: acc
        })
      }).then(() => {
        document.getElementById("status").innerText = "โ ุชู ุงูุชุณุฌูู ุจูุฌุงุญ";
      }).catch(() => {
        document.getElementById("status").innerText = "โ ุฎุทุฃ ูู ุงูุฅุฑุณุงู";
      });
    },
    err => {
      document.getElementById("status").innerText =
        "โ ูู ูุชู ุงูุญุตูู ุนูู ุงููููุนุ ูุนูู GPS";
      console.error(err);
    },
    {
      enableHighAccuracy: true,
      timeout: 15000,
      maximumAge: 0
    }
  );
}
</script>

</body>
</html>
